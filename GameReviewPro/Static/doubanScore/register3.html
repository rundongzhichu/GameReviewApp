<!DOCTYPE html>

<html lang="en">

<head>
    <meta charset="utf-8" />

    <title>注册</title>

    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="keywords" content="盗版豆瓣">
    <meta name="description" content="嘤嘤狂吠嘤">

    <link rel="stylesheet" type="text/css" href="css/register2.css" />
    <link rel="stylesheet" type="text/css" href="css/style.1.css" />
    <!--引入外部css文件-->

    <script src="http://libs.baidu.com/jquery/2.0.0/jquery.min.js"></script>
    <script>
        (function (window, document) {
            var SliderBar = function (targetDom, options) {
                // 判断是用函数创建的还是用new创建的。这样我们就可以通过MaskShare("dom") 或 new MaskShare("dom")来使用这个插件了  
                if (!(this instanceof SliderBar)) return new SliderBar(targetDom, options);
                // 参数
                this.options = this.extend({
                    dataList: []
                }, options);
                // 获取dom
                this.targetDom = document.getElementById(targetDom);
                var dataList = this.options.dataList;
                if (dataList.length > 0) {
                    var html = "<div class='slide-box'><div class='slide-img-block'>" +
                        "<div class='slide-loading'></div><div class='slide-img-border'>" +
                        "<div class='scroll-background slide-top'></div><div class='slide-img-div'>" +
                        "<div class='slide-img-nopadding'><img class='slide-img' id='slideImg' src='' />" +
                        "<div class='slide-block' id='slideBlock'></div><div class='slide-box-shadow' id='cutBlock'></div></div>" +
                        "<div class='scroll-background  slide-img-hint-info' id='slideHintInfo'>" +
                        "<div class='slide-img-hint'><div class='scroll-background slide-icon' id='slideIcon'></div>" +
                        "<div class='slide-text'><span class='slide-text-type' id='slideType'></span>" +
                        "<span class='slide-text-content' id='slideContent'></span></div></div></div></div>" +
                        "<div class='scroll-background slide-bottom'>" +
                        "<div class='scroll-background slide-bottom-refresh' id='refreshBtn' title='更换图片'></div>" +
                        "<div class='slide-bottom-no-logo'></div></div></div></div>" +
                        "<div class='scroll-background scroll-bar'>" +
                        "<div class='scroll-background slide-btn' id='slideBtn'></div>" +
                        "<div class='slide-title' id='slideHint'> <-按住滑块，拖动完成上面拼图</div></div></div>";
                    this.targetDom.innerHTML = html;
                    this.slideBtn = document.getElementById("slideBtn");                 // 拖拽按钮
                    this.refreshBtn = document.getElementById("refreshBtn");             // 换图按钮
                    this.slideHint = document.getElementById("slideHint");               // 提示名称
                    this.slideImg = document.getElementById("slideImg");                 // 图片
                    this.cutBlock = document.getElementById("cutBlock");                 // 裁剪区域
                    this.slideBlock = document.getElementById("slideBlock");             // 裁剪的图片
                    this.slideIcon = document.getElementById("slideIcon");               // 正确、失败的图标
                    this.slideType = document.getElementById("slideType");               // 正确、失败
                    this.slideContent = document.getElementById("slideContent");         // 正确、失败的正文
                    this.slideHintInfo = document.getElementById("slideHintInfo");       // 弹出
                    this.resultX = 0;
                    this.startX = 0;
                    this.timer = 0;
                    this.startTamp = 0;
                    this.endTamp = 0;
                    this.x = 0;
                    this.imgWidth = 0;
                    this.imgHeight = 0;
                    this.imgList = [];
                    this.isSuccess = true;
                    for (var i = 1; i < 10; i++) {
                        this.imgList.push(i + ".jpg");
                    }
                }
                this.init();
            }
            SliderBar.prototype = {
                init: function () {
                    this.event();
                },
                extend: function (obj, obj2) {
                    for (var k in obj2) {
                        obj[k] = obj2[k];
                    }
                    return obj;
                },
                event: function () {
                    var _this = this;
                    _this.reToNewImg();
                    _this.slideBtn.onmousedown = function (event) {
                        _this.mousedown(_this, event);
                    }
                    _this.refreshBtn.onclick = function () {
                        _this.refreshBtnClick(_this);
                    }
                },
                refreshBtnClick: function (_this) {
                    _this.isSuccess = true;
                    _this.slideBlock.style.cssText = "";
                    _this.cutBlock.style.cssText = "";
                    _this.reToNewImg();
                },
                reToNewImg: function () {
                    var _this = this;
                    var index = Math.round(Math.random() * 8);         // 该方法有等于0 的情况
                    var imgSrc = "./image/images/" + _this.imgList[index] + "";
                    _this.slideImg.setAttribute("src", imgSrc);
                    _this.slideBlock.style.backgroundImage = "url(" + imgSrc + ")";
                    _this.slideImg.onload = function (e) {
                        e.stopPropagation();
                        _this.imgWidth = _this.slideImg.offsetWidth;                   // 图片宽
                        _this.imgHeight = _this.slideImg.offsetHeight;                 // 图片高
                    }
                },
                cutImg: function () {
                    var _this = this;
                    _this.cutBlock.style.display = "block";
                    var cutWidth = _this.cutBlock.offsetWidth;                // 裁剪区域宽
                    var cutHeight = _this.cutBlock.offsetHeight;              // 裁剪区域高
                    // left 
                    _this.resultX = Math.floor(Math.random() * (_this.imgWidth - cutWidth * 2 - 4) + cutWidth);
                    // top
                    var cutTop = Math.floor(Math.random() * (_this.imgHeight - cutHeight * 2) + cutHeight);
                    // 设置样式
                    _this.cutBlock.style.cssText = "top:" + cutTop + "px;" + "left:" + _this.resultX + "px; display: block;";
                    _this.slideBlock.style.top = cutTop + "px";
                    _this.slideBlock.style.backgroundPosition = "-" + _this.resultX + "px -" + cutTop + "px";
                    _this.slideBlock.style.opacity = "1";
                },
                mousedown: function (_this, e) {
                    e.preventDefault();
                    _this.startX = e.clientX;
                    _this.startTamp = (new Date()).valueOf();
                    var target = e.target;
                    target.style.backgroundPosition = "0 -216px";
                    _this.slideHint.style.opacity = "0";
                    if (_this.isSuccess) {
                        _this.cutImg();
                    }
                    document.addEventListener('mousemove', mousemove);
                    document.addEventListener('mouseup', mouseup);

                    // 拖拽
                    function mousemove(event) {
                        _this.x = event.clientX - _this.startX;
                        if (_this.x < 0) {
                            _this.slideBtn.style.left = "0px";
                            _this.slideBlock.style.left = "2px";
                        } else if (_this.x >= 0 && _this.x <= 217) {
                            _this.slideBtn.style.left = _this.x + "px";
                            _this.slideBlock.style.left = _this.x + "px";
                        } else {
                            _this.slideBtn.style.left = "217px";
                            _this.slideBlock.style.left = "217px";
                        }
                        _this.slideBtn.style.transition = "none";
                        _this.slideBlock.style.transition = "none";
                    };
                    // 鼠标放开
                    function mouseup() {
                        document.removeEventListener('mousemove', mousemove);
                        document.removeEventListener('mouseup', mouseup);
                        var left = _this.slideBlock.style.left;
                        left = parseInt(left.substring(0, left.length - 2));

                        // 判断是否输入用户名和密码
                        var username1 = document.getElementById("username").value;
                        var password1 = document.getElementById("password").value;
                        var judgement = false;
                        if (username1 == "" || password1 == "") {
                            alert("请输入用户名或密码！");
                            judgement = false;
                        }
                        else {
                            judgement = true;
                        }

                        if (judgement == true) {
                            if (_this.resultX > (left - 2) && _this.resultX < (left + 2)) {
                                _this.isSuccess = true;
                                _this.endTamp = (new Date()).valueOf();
                                _this.timer = ((_this.endTamp - _this.startTamp) / 1000).toFixed(1);
                                // 裁剪图片(拼图的一块)
                                _this.slideBlock.style.opacity = "0";
                                _this.slideBlock.style.transition = "opacity 0.6s";
                                // 裁剪的区域(黑黑的那一块)
                                _this.cutBlock.style.opacity = "0";
                                _this.cutBlock.style.transition = "opacity 0.6s";
                                // 正确弹出的图标
                                _this.slideIcon.style.backgroundPosition = "0 -1207px";
                                _this.slideType.className = "slide-text-type greenColor";
                                _this.slideType.innerHTML = "验证通过:";
                                _this.slideContent.innerHTML = "用时" + _this.timer + "s";
                                setTimeout(function () {
                                    _this.cutBlock.style.display = "none";
                                    _this.slideBlock.style.left = "2px";
                                    _this.reToNewImg();
                                }, 600);
                                _this.options.success && _this.options.success();
                                // 导入postData函数
                                new_element = document.createElement("script");
                                new_element.setAttribute("type", "text/javascript");
                                new_element.setAttribute("src", "postData.js");// 在这里引入了postData.js
                                document.head.appendChild(new_element);
                                // 判断是否注册成功
                                var result1;
                                result1 = postData();
                                result1 = true;
                                if (result1) {
                                    // 加载注册成功页面
                                    window.location.href = "registersuccess.html?" + "username=" + encodeURI(username1);
                                }
                                else {
                                    alert("注册失败");
                                }

                            } else {
                                _this.isSuccess = false;
                                // 设置样式
                                // 裁剪图片(拼图的一块)
                                _this.slideBlock.style.left = "2px";
                                _this.slideBlock.style.transition = "left 0.6s";
                                // 错误弹出的图标
                                _this.slideIcon.style.backgroundPosition = "0 -1229px";
                                _this.slideType.className = "slide-text-type redColor";
                                _this.slideType.innerHTML = "验证失败:";
                                _this.slideContent.innerHTML = "拖动滑块将悬浮图像正确拼合";
                                _this.options.fail && _this.options.fail();
                            }
                        }
                        else {
                            file = "../js/SliderBar.js";
                            var head = $("head").remove("script[role='reload']");
                            $("<scri" + "pt>" + "</scr" + "ipt>").attr({ role: 'reload', src: file, type: 'text/javascript' }).appendTo(head);
                        }
                        // 设置样式
                        _this.slideHintInfo.style.height = "22px";
                        setTimeout(function () {
                            _this.slideHintInfo.style.height = "0px";
                        }, 1300);
                        _this.slideBtn.style.backgroundPosition = "0 -84px";
                        _this.slideBtn.style.left = "0";
                        _this.slideBtn.style.transition = "left 0.6s";
                        _this.slideHint.style.opacity = "1";
                    }
                }
            }
            window.SliderBar = SliderBar;
        }(window, document));
    </script>
    <script>
        function postData() {
            var username2 = document.getElementById("username").value;
            var password2 = document.getElementById("password").value;
            var post_data = {
                "username": username2,
                "password": password2,
            };

            $.ajax({
                //url: {% url ' ' %},
                type: "POST",
                data: post_data,
                success: function (data) {
                    data = JSON.parse(data);
                    if (data["status"] == 400) {
                        return false;
                    } else {
                        return true;
                    }

                }
            });
        }
    </script>


</head>

<body class="login">

    <div class="loginpanel">

        <form class="form1" role="form" method="post">
            <p class="p1">
                欢迎注册盗版豆瓣
            </p>

            <br>


            <div class="form-group">
                <input type="text" class="input1" id="username" placeholder="用户名" required
                    oninvalid="setCustomValidity('用户名不能为空~');" oninput="setCustomValidity('');" name="username"
                    autocomplete="off">
            </div>

            <div class="form-group">
                <input type="password" class="input1" id="password" placeholder="密码" required
                    oninvalid="setCustomValidity('密码不能为空~');" oninput="setCustomValidity('');" name="password"
                    autocomplete="off">
            </div>

            <br>

            <div id="slideBar" style="visibility: visible">

            </div>

            <br>

        </form>

        <form class="form2" role="form">
            <div class="login-footer">
                &copy; MoyeMio
            </div>
        </form>

    </div>

    <script>
        function function2() {
            alert("111");
            var object1 = document.getElementById("button1");
            object1.style.visibility = "none";//显示
            alert(object1.style.visibility);
        }

    </script>

    <script>

        function createXHR() {
            //支持原生的XHR对象
            if (typeof XMLHttpRequest != "undefined") {
                return new XMLHttpRequest();
            }
            //适用于IE7之前的版本
            else if (typeof ActiveXObject != "undefined") {
                if (typeof arguments.callee.activeXString != "String") {
                    var versions = ["MSXML2.XMLHttp.6.0", "MSXML2.XMLHttp.3.0", "MSXMLHttp"];
                    var i, len;
                    for (i = 0, len = versions.length; i < len; i++) {
                        try {
                            new ActiveXObject(versions[i]);
                            arguments.callee.activeXString = versions[i];
                            break;
                        } catch (ex) {
                            //跳过
                        }
                    }
                }
                return new ActiveXObject(arguments.callee.activeXString);
            } else {
                throw new Error("No XHR object available.");
            }
        }


    </script>

    <script>
        var dataList = ["0", "1"];
        var options = {
            dataList: dataList,
            success: function () {
                console.log("show");
            },
            fail: function () {
                console.log("fail");
            }
        };
        SliderBar("slideBar", options);
    </script>

</body>

</html>